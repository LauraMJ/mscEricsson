<!DOCTYPE html>
<html>

<head>
<title>Admin Home</title>
<form name="test">
	<input type="hidden" name="test2">
</form>
<p name="usernameTag" id="usernameTag">Username: </p>
<button type="button" onclick="window.location.replace('LogoutServlet')">Log
	out</button>

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script type="text/javascript">
	var locate = window.location;
	document.test.test2.value = locate;
	var text = document.test.test2.value;

	function addNewUser() {
		var url = 'rest/add/user';
		
		if($("#username").val().length == 0){
			alert("The username field can't be null");
			return;
		}
		if($("#password").val().length == 0){
			alert("The password field can't be null");
			return;
		}

		$.ajax({
			url : url,
			type : 'POST',
			contentType : 'application/json',
			dataType : "json",
			data : JSON.stringify({
				"username" : $("#username").val(),
				"password" : $("#password").val(),
				"role" : $('#role').val()
			}),
			success : function(data) {
				var message = "User '" + data.username + "' has been added.";
				alert(message);
				
				$("#username").val("");
				$("#password").val("");
			},
		    error: function(data) {
		    	alert("Failed to add user - username '" + $("#username").val() + "' has already been taken.");
// 		        alert("Status: " + data.val()); 
		    }
		});
	}

	function handlePost() {
		alert("successfully added a new user");
	}

	function passSelectedIMSI() {
		var selected = document.getElementById("selectDropdown");
		var text = selected.options[selected.selectedIndex].innerHTML;
		alert(text);
		
	}

	function delineate(str) {
		theleft = str.indexOf("=") + 1;
		theright = str.length;
		return (str.substring(theleft, theright));
	}
	
	function getUsername(){
		$.ajax({
			url : "rest/get/username",
			type : 'GET',
			contentType : 'application/json',
			dataType : "json",
			success : function(data) {
				var message = "Username:   '" + data.username + "'";
				document.getElementById("usernameTag").innerHTML = message;
			}
		});
	}
	
	var zork = delineate(text);
	getUsername();
// 	document.bull.bear.value = zork;

	//function passFilePath(){
	//	var filePathChosen = document.getElementById("filePath").value;
	//	alert(filePathChosen);
	//var pathToSend = JSON.parse(filePathChosen);
	//alert(pathToSend);
	//<input value='Import' type='submit'/>\
	//	$.ajax({
	//		type: 'POST',
	//		url: 'rest/testingQueries/import',
	//		contentType: 'application/json',
	//		data: JSON.stringify(filePathChosen)
	//	})
	//}	

	//Function to retrieve event/cause combinations by imsi
	function eventCauseForImsi() {
		var selected = document.getElementById('inputtedImsi').value;
		var url = 'rest/query/eventCausePerImsi';
		$.ajax({
			url : url,
			type : "POST",
			data : selected,
			contentType : "application/json",
			dataType : 'json',
			success : function(data) {
				var text = "<b> Results for IMSI '" + selected + "' </b><br>";
				if (data.length == 0) {
					text = "<b> No results for IMSI '" + selected
							+ "' </b><br>";
				}

				for (var i = 0; i < data.length; i++) {
					var obj = data[i];
					var printable = "Event ID: "
							+ obj.causeCodeEventIdCK.eventId + ", Cause Code: "
							+ obj.causeCodeEventIdCK.causeCode
							+ ", Description: " + obj.description + "<br>";
					text = text + printable;
				}
				document.getElementById("jsChangeArea").innerHTML = text;
			}
		});
	}

	function imsiPerTimePeriod() {
		var url = 'rest/query/imsiByTimePeriod';
		var Date1 = document.getElementById('date1date').value + " "
				+ document.getElementById('date1time').value;
		var Date2 = document.getElementById('date2date').value + " "
				+ document.getElementById('date2time').value;
		var JSONObject = { "Date1" : Date1, "Date2" : Date2};
		JSONObject = JSON.stringify(JSONObject);

		$.ajax({
			url : url,
			type : "POST",
			data : JSONObject,
			contentType : "application/json",
			dataType : 'json',
			success : function(data) {
 				var text = "<b> Results for time period " + Date1 + " to " + Date2 + "</b><br>";// + "' to '" + Date2 "' </b><br>";
				if (data.length == 0) {
					text = "<b> No results for that time period.</b><br>";
				}

				for (var i = 0; i < data.length; i++) {
					var obj = data[i];
					var printable = "IMSI: " + obj + "<br>";
					text = text + printable;
				}
				document.getElementById("jsChangeArea").innerHTML = text;
			}
		});
	}
	//CURRENTLY WORKING ON THIS FUNCTION
	function selectedIMSITimePeriod(){
		var selected = document.getElementById('imsiField').value;
		var url = 'rest/query/givenImsiByTimePeriod';
		var Date1 = document.getElementById('date1').value + " " + document.getElementById('time1');
		var Date2 = docoment.getElementById('date2').value + " " + document.getElementById('time2');
		var JSONObject = { "Date1" : Date1, "Date2" : Date2, "Imsi" : selected};
		JSONObject = JSON.stringify(JSONObject);
		
		$.ajax({
			url : url,
			type : "POST",
			date : JSONObject,
			contentType : "application/json",
			dataType : 'json',
			success : function(data) {
				var text = "<b> Results for IMSI " + selected + " for time period " + Date1 + " to " + Date2 + "</b><br>";
				if(data.length == 0){
					text = "<b>No results for lookup.</b><br>";
				}
				
				for (var i = 0; i < data.length; i++){
					var obj = data[i];
					var printable = "IMSI: " +obj + "<br>";
					text = text + printable;
						
				}
				document.getElementById("jsChangeArea").innerHTML = text;
				
			
			}
			
		});
		
	}

	function change(selection) {
		if (selection == "import") {
			var text = document.getElementById("jsChangeArea");
			text.innerHTML = "";
			//this eeds to be multipart/form-data

			text.innerHTML = "<form id='importForm' action='rest/restImportService/import' method='post' enctype='multipart/form-data'>\n\<b>Please choose a file to import</b><br><br>\
					<input id='selectedFile' type='file' name='selectedFile' value='' /><br><br>\
					<button type='submit' id='testButton' onclick='passFilePath()'>import</button>\
				</form><hr>";
		} else if (selection == "users") {
			var text = document.getElementById("jsChangeArea");
			text.innerHTML = "";
			text.innerHTML = "<form id='newUserForm' method='post' onsubmit='return false'>\n\<b>Add New User</b><br><br>Username:<input id='username' type='text' User='user'><br><br>Password:<input id='password' type='password' Password='password'><br><br>Role:<select id='role' name='role' Role='role'><option value='administrator' Role='role'>Administrator</option><option value='customer service rep' Role='role'>Customer Service Representative</option><option value='support engineer' Role='role'>Support Engineer</option><option value='network mgmt engineer' Role='role'>Network Management Engineer</option></select><br><br><input id='submitButton' type='submit' value='Submit' onclick='addNewUser()'/></form><hr>";
			// 	text.innerHTML="<form enctype='application/json' action='rest/add/user' id='createUserForm' method='post'>\n\<b>Add New User</b><br><br>Type:<select name='role'><option value='admin'>Admin</option><option value='servRep'>Customer Service Representative</option><option value='supEng'>Support Engineer</option><option value='netMGMT'>Network Management Engineer</option></select><br><br>Username:<input name='username' type='text' username='Username'><br><br>Password:<input name='password' type='password' password1='Password'><br><br>Password:<input type='password' password2='Password'><br><br><input id='addUserButton' type='submit' value='Add User'/></form>";
			// 			text.innerHTML = "<form method='POST' action='rest/add/user'>\n\<b>Add New User</b><br><br>Username:<input name='username'><br><br>Password:<input name='password' type='password'><br><br>Role:<select name='role'><option value='administrator'>Administrator</option><option value='customer service rep'>Customer Service Representative</option><option value='support engineer'>Support Engineer</option><option value='network mgmt engineer'>Network Management Engineer</option></select><br><br><input type='submit' value='Add User'/></form>";

			//needs to be check to make sure both fields have entered the same password on button click
			document.getElementById('usernameField').onkeydown = function(event) {
				var key = event.keyCode || event.which;

				if (key == 32) {
					if (event.preventDefault)
						event.preventDefault();
					event.returnValue = false;
				}
			};

		} else if (selection == "custIMSI") {
			var text = document.getElementById("jsChangeArea");
			text.innerHTML = "";
			text.innerHTML = "<form id='enterIMSIForm' method='post' onsubmit='return false'>\n\<b>Please Enter IMSI</b><br><br>IMSI:<input id='inputtedImsi' type='text' IMSI='imsi'><input id='submitButton' type='submit' value='Submit' onclick='eventCauseForImsi()'/></form><hr>";
			//Needs to display table when button is clicked
		} else if (selection == "suppIMSI") {
			var text = document.getElementById("jsChangeArea");
			text.innerHTML = "<form id='timedate' method='post' onsubmit='return false'>\n\<b>Please Select Time Range</b><br><br>From:<input id='date1date' type='date' name='date1'/><input id='date1time' type='time' name='time1'/>To:<input id='date2date' type='date' name='date2'/><input id='date2time' type='time' name='time2'/><br><br><input id='submitButton' type='submit' value='Submit' onclick='imsiPerTimePeriod()'/></form><hr>";
		} else if (selection == "mgmtIMSI") {
			var text = document.getElementById("jsChangeArea");
			text.innerHTML = "<form id='IMSISelect' method='post' onsubmit='return false'>\n\<b>Please Enter IMSI</b><br><br><input id='imsiField' type='text'<b><br><br>Please Select Time Range</b><br><br>From:<input type='date' id='date1' name='date1'/><input type='time' id='time1' name='time1'/>To:<input type='date' id='date2' name='date2'/><input type='time' id='time2' name='time2'/><button id='testButton' onclick='selectedIMSITimePeriod()'>Submit</button></form><hr>";
		} else {
			alert("Problemoooo!");
		}
	}
	///
</script>

<style>
table, th, td {
	border: 1px solid black;
	text-align: left;
	vertical-align: top;
	padding: 0;
}

html, body {
	height: 100%;
}
</style>
</head>

<body>
	<table style="width: 100%; height: 98%; border: 1px;">
		<tr>
			<th id="header" colspan="3" style="height: 100px">header
			</td>
		</tr>
		<tr>
			<td rowspan="2" style="height: 400px; width: 140px;"><b>Admin:</b>
				<br> <a id="importLink" href="#"
				onclick="change('import');return false;">Import Data</a> <br> <!--<a id="errorLink" href="#" onclick="change('errors');return false;">Error Log Count</a><br>-->
				<a id="usersLink" href="#" onclick="change('users');return false;">Users</a>
				<br> <br> <b>Customer Service:</b> <br> <a
				id="custIMSI" href="#" onclick="change('custIMSI');return false;">IMSI
					Failures by ID</a> <br> <br> <b>Support Eng.:</b> <br> <a
				id="suppIMSI" href="#" onclick="change('suppIMSI');return false;">IMSI
					Failures by Time Range</a> <br> <br> <b>Net. Mgmt Eng.:</b> <br>
				<a id="mgmtIMSI" href="#" onclick="change('mgmtIMSI');return false;">IMSI
					Failures by ID and Time Range</a> <br> <br></td>
			<td id="jsChangeArea">JS changing area</td>
		</tr>
		<tr>
			<td colspan="3" style="height: 20px">footer</td>
		</tr>
	</table>
</body>

</html>
